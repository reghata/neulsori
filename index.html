<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>늘소리</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
</head>
<body class="font-large">
    <!-- 스플래시 화면 -->
    <div id="splash-screen" class="screen active">
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh;">
            <h1 style="font-size: 72px; color: #4CAF50; margin-bottom: 30px;">늘소리</h1>
            <p style="font-size: 24px; color: #666; margin-bottom: 40px;">단어 말하기</p>
            <button onclick="startApp()" style="
                background: #4CAF50; 
                color: white; 
                border: none; 
                padding: 20px 40px; 
                font-size: 24px; 
                border-radius: 15px; 
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                transition: all 0.3s;
            " onmouseover="this.style.background='#45A049'" onmouseout="this.style.background='#4CAF50'">
                시작하기
            </button>
        </div>
    </div>

    <!-- 홈 화면 -->
    <div id="home-screen" class="screen">
        <div class="sticky-header">
            <header>
                <div>
                    <h1 class="logo">
                        <img src="assets/logo.png" alt="늘">
                        <span>소리</span>
                    </h1>
                </div>
                <div></div>
                <div></div>
            </header>
        </div>
        <div class="main-menu">
            <button class="menu-btn" onclick="showScreen('conversation-screen')">
                <span class="icon">🗣️</span>
                <span>대화</span>
            </button>
            <button class="menu-btn" onclick="showScreen('practice-list-screen', 'reading')">
                <span class="icon">📖</span>
                <span>읽기 연습</span>
            </button>
            <button class="menu-btn" onclick="showScreen('practice-list-screen', 'shadowing')">
                <span class="icon">🎙️</span>
                <span>따라말하기 연습</span>
            </button>
            <button class="menu-btn" onclick="showScreen('settings-screen')">
                <span class="icon">⚙️</span>
                <span>설정</span>
            </button>
            <button class="menu-btn" onclick="showScreen('help-screen')">
                <span class="icon">❓</span>
                <span>도움말</span>
            </button>
        </div>
    </div>

    <!-- 대화 화면 -->
    <div id="conversation-screen" class="screen">
        <div class="sticky-header">
            <header>
                <div>
                    <button class="icon-btn" onclick="showScreen('home-screen')">←</button>
                </div>
                <div>
                    <h2>대화</h2>
                </div>
                <div class="header-icons">
                    <button class="icon-btn" onclick="goToSettings('conversation-screen')">⚙️</button>
                    <button class="icon-btn" id="edit-mode-btn" onclick="toggleEditMode()">✏️</button>
                </div>
            </header>
            <div class="sort-toggle">
                <button id="sort-alpha" class="active" onclick="changeSortOrder('alphabet')">가나다라</button>
                <button id="sort-fav" onclick="changeSortOrder('favorites')">즐겨찾기</button>
                <button id="sort-freq" onclick="changeSortOrder('frequency')">자주사용</button>
            </div>
        </div>
        <div class="word-container" id="word-list-container"></div>
        <button class="fab" onclick="openWordModal()">+</button>
    </div>

    <!-- 연습 단어 선택 화면 -->
    <div id="practice-list-screen" class="screen">
        <div class="sticky-header">
            <header>
                <div>
                    <button class="icon-btn" onclick="showScreen('home-screen')">←</button>
                </div>
                <div>
                    <h2 id="practice-list-title">연습 단어 선택</h2>
                </div>
                <div class="header-icons">
                    <button class="icon-btn" onclick="goToSettings('practice-list-screen')">⚙️</button>
                </div>
            </header>
        </div>
        <div class="word-container" id="practice-word-list-container"></div>
        <button class="fab" onclick="openWordModal()">+</button>
    </div>

    <!-- 연습 화면 -->
    <div id="practice-screen" class="screen">
        <header>
            <button class="icon-btn" onclick="showScreen('practice-list-screen', currentPracticeMode)">←</button>
            <h2 id="practice-title">연습</h2>
            <div class="header-icons">
                <button class="icon-btn" onclick="goToSettings('practice-screen')">⚙️</button>
            </div>
        </header>
        <div class="practice-container">
            <div id="practice-word-card" class="practice-word-card">
                <p id="practice-card-label">목표 단어</p>
                <h3 id="target-word-display"></h3>
            </div>
            <div id="listen-button-container" style="display: none;">
                <button class="practice-btn" onclick="speak(practiceWord.text)">
                    <span class="icon">🔊</span>
                    <span>단어 듣기</span>
                </button>
            </div>
            <div class="mic-button-container">
                <button id="mic-btn" class="mic-btn" onclick="startRecognition()">
                    <span class="icon">🎤</span>
                </button>
                <p id="mic-status">버튼을 누르고 말씀하세요</p>
            </div>
            <div class="practice-result-card">
                <p>나의 발음</p>
                <h3 id="recognized-text-display">-</h3>
                <p class="similarity-score">정확도: <span id="similarity-score-display">0%</span></p>
            </div>
        </div>
    </div>

    <!-- 도움말 화면 -->
    <div id="help-screen" class="screen">
        <div class="sticky-header">
            <header>
                <div>
                    <button class="icon-btn" onclick="showScreen('home-screen')">←</button>
                </div>
                <div>
                    <h2>도움말</h2>
                </div>
                <div class="header-icons">
                    <button class="icon-btn" onclick="goToSettings('help-screen')">⚙️</button>
                </div>
            </header>
        </div>
        <div class="help-container">
            <div class="help-section">
                <div class="help-section-header">
                    <h3>🏠 홈 화면</h3>
                    <button class="help-audio-btn" onclick="speakHelpSectionDirect()">🔊</button>
                </div>
                <p>앱을 실행하면 4개의 메뉴가 나타납니다.</p>
                <ul>
                    <li><strong>🗣️ 대화</strong>: 일상 대화에 필요한 단어들을 음성으로 들려줍니다</li>
                    <li><strong>📖 읽기 연습</strong>: 화면에 보이는 단어를 따라 읽는 연습을 합니다</li>
                    <li><strong>🎙️ 따라말하기 연습</strong>: 소리를 들은 후 따라 말하는 연습을 합니다</li>
                    <li><strong>❓ 도움말</strong>: 이 화면입니다</li>
                </ul>
            </div>

            <div class="help-section">
                <div class="help-section-header">
                    <h3>🗣️ 대화 화면 사용법</h3>
                    <button class="help-audio-btn" onclick="speakHelpSectionDirect()">🔊</button>
                </div>
                <h4>단어 듣기</h4>
                <p>• 단어를 <strong>누르면</strong> 음성이 나옵니다<br>
                • 재생 중인 단어는 <strong>초록색</strong>으로 표시됩니다</p>
                
                <h4>단어 정렬하기</h4>
                <p>화면 상단의 버튼으로 단어를 정렬할 수 있습니다:</p>
                <ul>
                    <li><strong>가나다라</strong>: 가나다라 순서로 정렬</li>
                    <li><strong>즐겨찾기</strong>: 즐겨찾기한 단어만 보기</li>
                    <li><strong>자주사용</strong>: 많이 사용한 단어 순서로 정렬</li>
                </ul>

                <h4>즐겨찾기 추가/제거</h4>
                <p>• 단어 옆의 <strong>⭐</strong> 버튼을 누르면 즐겨찾기에 추가됩니다<br>
                • 다시 누르면 즐겨찾기에서 제거됩니다</p>

                <h4>단어 추가하기</h4>
                <p>• 화면 우하단의 <strong>+</strong> 버튼을 누릅니다<br>
                • 새로운 단어를 입력하고 <strong>추가</strong> 버튼을 누릅니다</p>

                <h4>단어 편집/삭제하기</h4>
                <ol>
                    <li>화면 우상단의 <strong>✏️</strong> 버튼을 누릅니다</li>
                    <li>편집하려는 단어의 <strong>✏️</strong> 버튼을 눌러서 수정합니다</li>
                    <li>삭제하려는 단어의 <strong>🗑️</strong> 버튼을 눌러서 삭제합니다</li>
                    <li>완료 후 화면 우상단의 <strong>✓</strong> 버튼을 누릅니다</li>
                </ol>
            </div>

            <div class="help-section">
                <div class="help-section-header">
                    <h3>📖 읽기 연습 사용법</h3>
                    <button class="help-audio-btn" onclick="speakHelpSectionDirect()">🔊</button>
                </div>
                <h4>연습 시작하기</h4>
                <ol>
                    <li><strong>읽기 연습</strong> 메뉴를 누릅니다</li>
                    <li>연습할 단어를 선택합니다</li>
                    <li>화면에 나타난 단어를 보고 읽습니다</li>
                </ol>

                <h4>음성 인식 사용하기</h4>
                <ol>
                    <li><strong>🎤</strong> 버튼을 누릅니다</li>
                    <li>단어를 또렷하게 말합니다</li>
                    <li>발음 정확도가 표시됩니다</li>
                </ol>
            </div>

            <div class="help-section">
                <div class="help-section-header">
                    <h3>🎙️ 따라말하기 연습 사용법</h3>
                    <button class="help-audio-btn" onclick="speakHelpSectionDirect()">🔊</button>
                </div>
                <h4>연습 시작하기</h4>
                <ol>
                    <li><strong>따라말하기 연습</strong> 메뉴를 누릅니다</li>
                    <li>연습할 단어를 선택합니다</li>
                </ol>

                <h4>단어 듣고 따라하기</h4>
                <ol>
                    <li><strong>🔊 단어 듣기</strong> 버튼을 눌러서 목표 단어를 들어봅니다</li>
                    <li>단어 카드를 누르면 목표 단어를 볼 수 있습니다</li>
                    <li><strong>🎤</strong> 버튼을 누르고 들은 단어를 따라 말합니다</li>
                    <li>발음 정확도가 표시됩니다</li>
                </ol>
            </div>

            <div class="help-section">
                <div class="help-section-header">
                    <h3>⚙️ 설정 사용법</h3>
                    <button class="help-audio-btn" onclick="speakHelpSectionDirect()">🔊</button>
                </div>
                <p>각 화면 우상단의 <strong>⚙️</strong> 버튼을 누르면 설정을 변경할 수 있습니다.</p>
                
                <h4>글자 크기 조절</h4>
                <ul>
                    <li><strong>보통</strong>: 일반적인 크기</li>
                    <li><strong>크게</strong>: 조금 더 큰 글자</li>
                    <li><strong>아주 크게</strong>: 가장 큰 글자 </li>
                </ul>

                <h4>말하기 속도 조절</h4>
                <ul>
                    <li><strong>보통</strong>: 일반적인 말하기 속도</li>
                    <li><strong>느리게</strong>: 조금 더 천천히</li>
                    <li><strong>아주 느리게</strong>: 가장 천천히 </li>
                </ul>

                <h4>음성 선택</h4>
                <ul>
                    <li><strong>첫 번째 음성</strong>: 내장된 첫 번째 음성 재생</li>
                    <li><strong>두 번째 음성</strong>: 내장된 두 번째 음성 재생</li>
                </ul>
            </div>

            <div class="help-section">
                <div class="help-section-header">
                    <h3>💡 사용 팁</h3>
                    <button class="help-audio-btn" onclick="speakHelpSectionDirect()">🔊</button>
                </div>
                <h4>효과적인 사용 방법</h4>
                <ul>
                    <li><strong>매일 조금씩</strong>: 하루 10-15분씩 꾸준히 사용하세요</li>
                    <li><strong>즐겨찾기 활용</strong>: 자주 사용하는 단어는 즐겨찾기에 추가하세요</li>
                    <li><strong>반복 연습</strong>: 같은 단어를 여러 번 연습해보세요</li>
                    <li><strong>단계별 접근</strong>: 쉬운 단어부터 시작해서 점차 어려운 단어로 진행하세요</li>
                </ul>

                <h4>환자분이 사용하기 어려워할 때</h4>
                <ul>
                    <li>글자 크기를 <strong>아주 크게</strong> 설정해보세요</li>
                    <li>말하기 속도를 <strong>아주 느리게</strong> 설정해보세요</li>
                    <li>처음에는 <strong>연습</strong> 기능을 사용하다가 점차 <strong>대화</strong> 기능을 사용해보세요</li>
                </ul>

                <h4>마이크 사용 시 주의사항</h4>
                <ul>
                    <li>조용한 환경에서 사용하세요</li>
                    <li>마이크에서 20-30cm 정도 떨어져서 말하세요</li>
                    <li>너무 크게 말하지 마시고 또렷하게 발음하세요</li>
                </ul>
            </div>

            <div class="help-section">
                <div class="help-section-header">
                    <h3>🆘 문제 해결</h3>
                    <button class="help-audio-btn" onclick="speakHelpSectionDirect()">🔊</button>
                </div>
                <h4>음성이 나오지 않을 때</h4>
                <ul>
                    <li>기기의 볼륨을 확인하세요</li>
                    <li>무음 모드가 켜져있지 않은지 확인하세요</li>
                </ul>

                <h4>마이크가 작동하지 않을 때</h4>
                <ul>
                    <li>브라우저에서 마이크 권한을 허용했는지 확인하세요</li>
                    <li>다른 앱에서 마이크를 사용하고 있지 않은지 확인하세요</li>
                </ul>

                <h4>앱이 느려질 때</h4>
                <ul>
                    <li>브라우저를 완전히 닫았다가 다시 열어보세요</li>
                    <li>기기를 재시작해보세요</li>
                </ul>
            </div>

            <div class="help-section">
                <div class="help-section-header">
                    <h3>📞 문의하기</h3>
                    <button class="help-audio-btn" onclick="speakHelpSectionDirect()">🔊</button>
                </div>
                <p>사용 중 궁금한 점이나 문제가 있으시면 언제든 연락해주세요.</p>
                <p><strong>이메일</strong>: jinkyung.kim85@gmail.com</p>
            </div>
        </div>
    </div>

    <!-- 설정 화면 -->
    <div id="settings-screen" class="screen">
        <header>
            <button class="icon-btn" onclick="goBackFromSettings()">←</button>
            <h2>설정</h2>
            <div></div>
        </header>
        <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
            <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 10px;">
                <h3>글자 크기</h3>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button data-setting-value="normal" onclick="changeFontSize('normal')">보통</button>
                    <button data-setting-value="large" onclick="changeFontSize('large')">크게</button>
                    <button data-setting-value="xlarge" onclick="changeFontSize('xlarge')">아주 크게</button>
                </div>
            </div>
            <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 10px;">
                <h3>말하기 속도</h3>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button data-setting-value="normal" onclick="changeSpeechRate('normal')">보통</button>
                    <button data-setting-value="slow" onclick="changeSpeechRate('slow')">느리게</button>
                    <button data-setting-value="verySlow" onclick="changeSpeechRate('verySlow')">아주 느리게</button>
                </div>
            </div>
            <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 10px;">
                <h3>음성 선택</h3>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button data-setting-value="first" onclick="changeVoiceSelection('first')">첫 번째 음성</button>
                    <button data-setting-value="second" onclick="changeVoiceSelection('second')">두 번째 음성</button>

                </div>
            </div>
            <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 10px;">
                <h3>정보</h3>
                <p id="version-info" style="color: #999; text-align: center; padding: 20px; cursor: pointer;">
                    늘소리 v1.0.0
                </p>
                <p style="color: #999; text-align: center; padding: 10px; margin: 10px 0; font-size: 0.9em;">
                    문의: jinkyung.kim85@gmail.com
                </p>                
            </div>
        </div>
    </div>
    
    <!-- 단어 추가/편집 모달 -->
    <div id="word-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3 id="modal-title">새 단어 추가</h3>
            <input type="text" id="word-input" placeholder="단어를 입력하세요">
            <div class="modal-buttons">
                <button id="confirm-word-btn" class="primary">추가</button>
                <button id="cancel-word-btn">취소</button>
            </div>
        </div>
    </div>
    
    <!-- 치료사 모드 화면 -->
    <div id="therapist-screen" class="screen">
        <header>
            <button class="icon-btn" onclick="showScreen('settings-screen')">←</button>
            <h2>치료사 모드</h2>
            <div></div>
        </header>
        <div style="max-width: 600px; margin: 0 auto; padding: 20px;">
            <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 10px;">
                <h3>빠른 단어 추가</h3>
                <textarea id="bulk-words" placeholder="여러 단어를 한 줄씩 입력하세요" style="width: 100%; height: 150px; padding: 10px; font-size: 16px; border: 2px solid #ddd; border-radius: 5px;"></textarea>
                <button onclick="bulkAddWords()" style="margin-top: 10px; width: 100%; padding: 15px; background: #4CAF50; color: white; border: none; border-radius: 10px; font-size: 18px;">일괄 추가</button>
            </div>
            <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 10px;">
                <h3>데이터 관리</h3>
                <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
                    <button onclick="document.getElementById('file-input').click()">📥 단어 가져오기 (CSV)</button>
                    <input type="file" id="file-input" accept=".csv,.txt" style="display: none;" onchange="importWords(event)">
                    <button onclick="exportWords()">📤 단어 내보내기</button>
                    <button onclick="resetApp()" style="background: #f44336; color: white;">🔄 초기화</button>
                </div>
            </div>
            <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 10px;">
                <h3>사용 통계</h3>
                <div id="stats-display" style="line-height: 1.8;"></div>
            </div>
        </div>
    </div>

    <script src="js/Datastorage.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
